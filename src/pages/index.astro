---
import Layout from "@layouts/Layout.astro";
import BannerPrincipal from "@components/BannerPrincipal.astro";
import Servicios from "@components/Servicios.astro";
import TrabajosRealizados from "@components/TrabajosRealizados.astro";
import Precios from "@components/Precios.astro";
import Nosotros from "@components/Nosotros.astro";
import Contacto from "@components/Contacto.astro";
import { client } from "@lib/client.js";

const data = await client.getEntries({
  content_type: "heroBanner",
});

const hero = data.items[0].fields;
---

<Layout title="Catalina Romo - Estilista">
  <BannerPrincipal
    title={hero.titulo}
    subtitle={hero.subtitulo}
    btnText1={hero.textoBoton1}
    btnLink1={hero.botnLink1}
    btnText2={hero.textoBotn2}
    btnLink2={hero.botonLink2}
    banner={hero.banner}
    isActive={hero.isActive}
  />
  <Servicios />
  <TrabajosRealizados />
  <Precios />
  <Nosotros />
  <Contacto />
</Layout>

<script>
  const sections = document.querySelectorAll("section[id]");
  const options = { threshold: 0.5 };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const title = entry.target.querySelector(".title-section");
      if (!title) return;

      if (entry.isIntersecting) {
        //Active Section
        const id = entry.target.getAttribute("id");
        //Update URL hash
        history.replaceState(null, "", `#${id}`);

        //Add active class to menu header
        document.querySelectorAll(".menu-header").forEach((link) => {
          const href = link.getAttribute("href");
          if (href === `#${id}`) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        title.classList.add("active-section");
      } else {
        //Inactive Section
        title.classList.remove("active-section");
      }
    });
  }, options);

  sections.forEach((section) => observer.observe(section));
</script>
